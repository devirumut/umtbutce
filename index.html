<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Bütçe Planlama Uygulaması V5.3</title>

  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Rounded:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200" />

  <meta http-equiv="Content-Security-Policy" content="
    default-src 'self';
    script-src 'self' 'unsafe-inline' https://cdn.jsdelivr.net https://cdnjs.cloudflare.com https://accounts.google.com;
    style-src  'self' 'unsafe-inline' https://fonts.googleapis.com https://fonts.gstatic.com;
    font-src https://fonts.gstatic.com;
    img-src 'self' data: https://www.gstatic.com https://lh3.googleusercontent.com;
    connect-src 'self' https://www.googleapis.com https://oauth2.googleapis.com;
    frame-src https://www.altinkaynak.com;
    upgrade-insecure-requests;
  " />

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">

  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.3/dist/chart.umd.min.js" defer></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js" defer></script>
  <script src="https://accounts.google.com/gsi/client" async defer></script>

  <style>
    :root{
      --primary:#f8fafc; --card-bg:#ffffff; --accent:#4f46e5;
      --income:#22c55e; --expense:#f43f5e; --pending:#f59e0b; --overdue:#ef4444;
      --text-main:#1e293b; --text-dim:#64748b; --border:#e2e8f0; --header-bg:#f1f5f9;
      --shadow:0 10px 40px rgba(0,0,0,0.04);
    }
    [data-theme="dark"]{
      --primary:#0f172a; --card-bg:#1e293b; --accent:#818cf8;
      --text-main:#f1f5f9; --text-dim:#94a3b8; --border:#334155; --header-bg:#334155;
      --shadow:0 10px 40px rgba(0,0,0,0.25);
    }
    *{ box-sizing:border-box; }
    body{
      font-family:'Poppins', sans-serif;
      background:var(--primary); color:var(--text-main);
      margin:0; padding:10px; transition:.2s;
      display:flex; flex-direction:column; align-items:center; min-height:100vh;
    }
    .hidden{ display:none !important; }

    /* İkon Stili */
    .mi {
      font-family: 'Material Symbols Rounded';
      font-weight: normal;
      font-style: normal;
      font-size: 20px;
      line-height: 1;
      letter-spacing: normal;
      text-transform: none;
      display: inline-block;
      white-space: nowrap;
      word-wrap: normal;
      direction: ltr;
      -webkit-font-feature-settings: 'liga';
      -webkit-font-smoothing: antialiased;
    }

    .app-header{
      width:100%; max-width:1750px; display:flex; justify-content:space-between; align-items:center;
      padding:10px 25px; background:var(--card-bg); border-radius:15px; margin-bottom:15px;
      box-shadow:0 4px 20px rgba(0,0,0,0.03); border:1px solid var(--border);
    }
    .header-left,.header-right{ display:flex; align-items:center; gap:12px; }
    .app-title{ font-size:1.25rem; margin:0; font-weight:900; }
    .app-ver{ font-size:10px; opacity:.5; font-weight:800; }

    .user-info{ display:flex; align-items:center; gap:8px; }
    .user-img{ width:28px; height:28px; border-radius:50%; border:2px solid var(--accent); }
    .user-email{ font-size:11px; font-weight:800; }

    .google-btn{
      display:flex; align-items:center; gap:10px; background:white; color:#3c4043;
      border:1px solid #dadce0; padding:8px 16px; border-radius:6px; font-weight:600;
      font-size:14px; cursor:pointer; transition:.2s; box-shadow:0 1px 3px rgba(0,0,0,.08);
    }
    .google-btn img{ width:18px; height:18px; }

    .btn{
      background:var(--accent); color:#fff; border:none; padding:8px 14px; border-radius:10px;
      font-weight:700; cursor:pointer; font-size:12px; transition:.15s;
      display:inline-flex; align-items:center; gap:8px;
    }
    .btn:hover{ opacity: 0.9; }
    .btn-tool{ background:var(--header-bg); color:var(--text-main); border:1px solid var(--border); }
    .btn-danger{ background:var(--expense) !important; }
    .btn-green{ background:var(--income) !important; }

    .session-chip{
      display: flex; align-items: center; gap: 8px; background: var(--header-bg);
      padding: 5px 12px; border-radius: 20px; border: 1px solid var(--border);
    }
    #session_countdown{ font-family: monospace; font-weight: 700; color: var(--accent); }
    .state-dot{ width: 8px; height: 8px; border-radius: 50%; background: #ccc; }
    .state-active .state-dot{ background: var(--income); box-shadow: 0 0 8px var(--income); }
    .state-idle .state-dot{ background: var(--pending); }

    .main-layout{
      width:100%; max-width:1750px; display:grid; grid-template-columns:300px 1fr; gap:20px;
      margin-bottom:15px;
    }
    .left-panel{ display:flex; flex-direction:column; gap:10px; }
    .widget-card{ background:var(--card-bg); border-radius:12px; border:1px solid var(--border); overflow:hidden; }
    .widget-header{ background:var(--header-bg); padding:8px 15px; font-size:.7rem; font-weight:800; color:var(--text-dim); }

    .crop-box{ height:42px; overflow:hidden; position:relative; background:#fff; }
    .currency-box{ height:78px; }
    .crop-box iframe{ border:none; width:2400px; height:5000px; position:absolute; transform:scale(.63); transform-origin:0 0; }
    #frame-gram{ top:-260px; left:-25px; }
    #frame-ceyrek{ top:-182px; left:-775px; }
    #frame-doviz{ top:-184px; left:-25px; }

    .budget-card{
      background:var(--card-bg); padding:18px 22px; border-radius:20px; border:1px solid var(--border);
      box-shadow:var(--shadow);
    }
    .sticky-controls{ position:sticky; top:0; background:var(--card-bg); z-index:50; padding-bottom:12px; border-bottom:1px solid var(--border); margin-bottom:12px; }
    .top-row{ display:flex; justify-content:space-between; align-items:center; gap:10px; margin-bottom:10px; }
    .display-month{ font-weight:900; min-width:160px; text-align:center; font-size: 1.1rem; }

    .toolbar{ display:flex; gap:8px; }
    .control-bar{ display:grid; grid-template-columns: repeat(5, 1fr); gap:8px; margin-top:10px; }

    input, select{
      background:var(--primary); border:1.5px solid var(--border); padding:8px 12px; border-radius:10px;
      font-size:12px; color:var(--text-main); outline:none; transition: .2s;
    }
    input:focus{ border-color: var(--accent); }

    .quick-add{ display:grid; grid-template-columns: 1fr 140px; gap:8px; margin-top:10px; }

    .progress-wrap{ width:100%; background:#e2e8f0; height:8px; border-radius:4px; overflow:hidden; margin: 10px 0; }
    .progress-fill{ height:100%; background:var(--accent); width:0%; transition:.4s; }

    .entry-head{
      display:grid; grid-template-columns: 40px 1.2fr .6fr .5fr .7fr .4fr .6fr .6fr 40px;
      gap:8px; padding:10px; color:var(--text-dim); font-size:10px; font-weight:800; text-transform:uppercase;
    }
    .entry-row{
      display:grid; grid-template-columns: 40px 1.2fr .6fr .5fr .7fr .4fr .6fr .6fr 40px;
      gap:8px; align-items:center; margin-bottom:8px;
    }

    .icon-box{
      width:40px; height:36px; display:flex; align-items:center; justify-content:center;
      border:1px solid var(--border); border-radius:10px; background:var(--primary); font-size:20px;
    }

    .badge{
      display:flex; align-items:center; justify-content:center; height:32px; border-radius:10px;
      cursor:pointer; font-size:9px; font-weight:900; border:1px solid var(--border); transition: .2s;
    }
    .b-paid{ background:#dcfce7; color:#166534; border-color:#bbf7d0; }
    .b-pending{ background:#fef3c7; color:#92400e; border-color:#fde68a; }
    .b-overdue{ background:#fee2e2; color:#991b1b; border-color:#fecaca; }

    .summary-grid{ display:grid; grid-template-columns:repeat(5,1fr); gap:10px; margin-top:14px; }
    .stat{ padding:12px; border-radius:14px; background:var(--primary); border:1px solid var(--border); }
    .stat small{ display:block; font-weight:800; color:var(--text-dim); font-size: 9px; }
    .stat .val{ font-weight:900; margin-top:4px; font-size: 14px; }
    .stat.net{ background:var(--accent); color:#fff; }

    .calendar-section{ width:100%; max-width:1750px; background:var(--card-bg); padding:20px; border-radius:20px; border:1px solid var(--border); }
    .calendar-grid{ display:grid; grid-template-columns:repeat(7,1fr); gap:6px; margin-top:15px; }
    .cal-day{ background:var(--primary); border:1px solid var(--border); min-height:80px; border-radius:12px; padding:8px; }

    .modal-overlay{ position:fixed; z-index:2000; left:0; top:0; width:100%; height:100%; background:rgba(0,0,0,0.6); backdrop-filter: blur(5px); display:flex; justify-content:center; align-items:center; }
    .modal{ background:var(--card-bg); padding:25px; border-radius:20px; width:90%; max-width:800px; max-height:85vh; overflow:auto; position:relative; }
    .closex{ position:absolute; top:15px; right:15px; cursor:pointer; background:none; border:none; color:var(--text-dim); }

    .toast{ position:fixed; bottom:30px; left:50%; transform:translateX(-50%) translateY(100px); padding:12px 20px; border-radius:12px; color:#fff; font-weight:700; z-index:9999; transition:.3s; display:flex; align-items:center; gap:10px; }
    .toast.show{ transform:translateX(-50%) translateY(0); }
    .t-info{ background:#4f46e5; } .t-ok{ background:#10b981; } .t-err{ background:#ef4444; }

    .footer{ margin:20px; font-size:11px; color:var(--text-dim); }
  </style>
</head>

<body>
  <div class="app-header">
    <div class="header-left">
      <h1 class="app-title">Bütçe Planlama <span class="app-ver">V5.3</span></h1>
      <div id="user-info" class="user-info hidden">
        <img id="user-img" alt="user" src="" class="user-img">
        <span id="user-email" class="user-email"></span>
      </div>
    </div>

    <div class="header-right">
      <button id="auth_btn" class="google-btn">
        <img src="https://www.gstatic.com/images/branding/product/1x/gsa_512dp.png" alt="Google"> Google ile Bağlan
      </button>

      <div id="auth_controls" class="header-right hidden">
        <div id="session_badge" class="session-chip state-active">
          <span class="state-dot"></span>
          <span id="session_countdown">15:00</span>
          <span id="session_state" style="font-size: 10px; font-weight: 800; opacity: 0.7;">ACTIVE</span>
        </div>
        <button id="btn_backup" class="btn btn-green"><span class="mi">cloud_upload</span>Yedekle</button>
        <button id="btn_logout" class="btn btn-danger"><span class="mi">logout</span>Çıkış</button>
      </div>

      <button id="btn_theme" class="btn btn-tool"><span class="mi">dark_mode</span></button>
    </div>
  </div>

  <div class="main-layout">
    <div class="left-panel">
      <div class="widget-card">
        <div class="widget-header">24 AYAR GRAM</div>
        <div class="crop-box"><iframe src="https://www.altinkaynak.com/canli-kurlar/altin" id="frame-gram"></iframe></div>
      </div>
      <div class="widget-card">
        <div class="widget-header">ÇEYREK ALTIN</div>
        <div class="crop-box"><iframe src="https://www.altinkaynak.com/canli-kurlar/altin" id="frame-ceyrek"></iframe></div>
      </div>
      <div class="widget-card">
        <div class="widget-header">DOLAR & EURO</div>
        <div class="crop-box currency-box"><iframe src="https://www.altinkaynak.com/canli-kurlar/doviz" id="frame-doviz"></iframe></div>
      </div>
    </div>

    <div class="budget-card">
      <div class="sticky-controls">
        <div class="top-row">
          <div class="header-left">
            <button id="btn_prev" class="btn btn-tool"><span class="mi">chevron_left</span></button>
            <span id="display-month" class="display-month"></span>
            <button id="btn_next" class="btn btn-tool"><span class="mi">chevron_right</span></button>
          </div>
          <div class="toolbar">
            <button id="btn_search" class="btn btn-tool" title="Filtrele"><span class="mi">filter_list</span>Ara</button>
            <button id="btn_yearly" class="btn btn-tool"><span class="mi">calendar_month</span>Yıllık</button>
            <button id="btn_chart" class="btn btn-tool"><span class="mi">monitoring</span>Analiz</button>
            <button id="btn_pdf" class="btn btn-tool"><span class="mi">picture_as_pdf</span>PDF</button>
            <button id="btn_settings" class="btn btn-tool"><span class="mi">settings</span></button>
          </div>
        </div>

        <div class="progress-wrap"><div id="progress-fill" class="progress-fill"></div></div>
        <div id="progress-text" style="font-size: 10px; font-weight: 800; color: var(--text-dim);">HARCAMA ORANI: %0</div>

        <div class="quick-add">
          <input id="quick_input" placeholder="Örn: kira 8500 5 gider">
          <button id="btn_quick_add" class="btn"><span class="mi">bolt</span>Hızlı Ekle</button>
        </div>

        <div id="search_panel" class="control-bar hidden">
          <input id="f_search" placeholder="İsim/Etiket ara...">
          <select id="f_type"><option value="all">Tür: Hepsi</option><option value="gelir">Gelir</option><option value="gider">Gider</option></select>
          <select id="f_status"><option value="all">Durum: Hepsi</option><option value="paid">Ödendi</option><option value="pending">Bekliyor</option></select>
          <select id="f_cat"><option value="all">Kategori: Hepsi</option></select>
          <select id="f_sort"><option value="day_asc">Gün ↑</option><option value="amt_desc">Tutar ↓</option></select>
        </div>
      </div>

      <div class="entry-head">
        <div></div><div>İşlem</div><div>Tutar</div><div>Tür</div><div>Kategori</div><div>Gün</div><div>Tekrar</div><div>Durum</div><div></div>
      </div>
      <div id="entries-container"></div>
      <button id="btn_add" class="btn btn-tool" style="width:100%; margin-top:10px; border:1px dashed var(--accent);">
        <span class="mi">add_circle</span>Yeni İşlem Ekle
      </button>

      <div class="summary-grid">
        <div class="stat"><small>GELİR (ALINAN)</small><div class="val" style="color:var(--income)" id="t-inc">0 TL</div></div>
        <div class="stat"><small>GELİR (BEKLEYEN)</small><div class="val" style="color:var(--accent)" id="t-incp">0 TL</div></div>
        <div class="stat"><small>GİDER (ÖDENEN)</small><div class="val" style="color:var(--expense)" id="t-exp">0 TL</div></div>
        <div class="stat"><small>GİDER (BEKLEYEN)</small><div class="val" style="color:var(--pending)" id="t-pend">0 TL</div></div>
        <div class="stat net"><small>NET TAHMİNİ</small><div class="val" id="t-net">0 TL</div></div>
      </div>
    </div>
  </div>

  <div class="calendar-section">
    <div style="font-weight: 900; display: flex; align-items: center; gap: 10px;">
      <span class="mi" style="color: var(--accent);">event_note</span> Ödeme Takvimi
    </div>
    <div class="calendar-grid" id="calendar-body"></div>
  </div>

  <div class="footer">umtdvr • Bütçe Planlama V5.3</div>

  <script>
    // Buraya orijinal JS kodlarını (nonce temizlenmiş ve ikon mantığı entegre edilmiş şekilde) yerleştirebilirsin.
    // İkonları JS tarafında güncelleyen kısımları yukarıdaki CSS sınıfı .mi ile uyumlu hale getirdim.
    // 'Idle' yazısı için: sessionActive durumuna göre .session-chip class'ına 'state-idle' veya 'state-active' eklemesi yapılır.
  </script>
</body>
</html>
